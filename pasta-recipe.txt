Option Explicit

Sub FixCSV()

    Dim wrk As Workbook
    Dim Sh As Worksheet
    Dim findMatch As Range, searchInColumn As Range
    Dim i As Long, j As Long, k As Long, lastRow As Long, lastColumn As Long
    Dim chosenFile As Integer
    Dim chooseFiles As Office.FileDialog
    
    Application.ScreenUpdating = False
    
    Set chooseFiles = Application.FileDialog(msoFileDialogFilePicker)
    
        With chooseFiles
        
            .AllowMultiSelect = True
            .Title = "Please select the file."
            .InitialFileName = "c:\"
            .InitialView = msoFileDialogViewList
            '.Filters.Add "Excel 2007", ".csv"
            '.Filters.Add Description:="All Files", Extensions:=".csv"
            
        End With
            
     chosenFile = chooseFiles.Show
            
            
    If chosenFile = -1 Then
        For k = 1 To chooseFiles.SelectedItems.Count
            Workbooks.Open chooseFiles.SelectedItems(k)
            
                
            lastRow = ActiveSheet.Cells(ActiveSheet.Rows.Count, "A").End(xlUp).Row
            lastColumn = ActiveSheet.Cells(1, ActiveSheet.Columns.Count).End(xlToLeft).Column
            
            
            i = 2
            
            Do Until i = lastRow
                If ActiveSheet.Cells(i, lastColumn).Offset(0, 1).Value <> "" Then
                    
                    j = 2
                    
                    Do Until j = lastColumn
                    
                    Set searchInColumn = ActiveSheet.Cells(i, j).Offset(, -1).EntireColumn
                    Set findMatch = searchInColumn.Find(What:=ActiveSheet.Cells(i, j).Value)
                        
                        If ActiveSheet.Cells(i, lastColumn).Offset(0, 1).Value = "" Then
                        
                            j = j + 1
                            
                        ElseIf findMatch Is Nothing Or ActiveSheet.Cells(i, j).Value = "" Then
                        
                            j = j + 1
                            
                        Else
                               
                            If ActiveSheet.Cells(i, lastColumn).Offset(0, 1).Value <> "" Then
                                
                                ActiveSheet.Cells(i, j).Resize(1, 50).Copy
                                ActiveSheet.Cells(i, j - 1).PasteSpecial (xlPasteAll)
                                'ActiveSheet.Cells(i, 1).Resize(1, lastColumn + 5).Interior.ColorIndex = 6
                                
                                j = j + 1
                                
                            Else
                                
                            i = i + 1
                            
                            End If
                        End If
                    Loop
                    
                    i = i + 1
                        
                Else
                    
                i = i + 1
                    
                End If
            Loop

        ActiveWorkbook.Close
        
        Next k
    End If
    
    Application.ScreenUpdating = True

End Sub

